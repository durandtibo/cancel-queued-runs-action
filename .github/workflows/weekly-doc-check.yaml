name: Weekly Documentation Check

on:
  schedule:
    - cron: "0 9 * * 5" # Run every Friday at 9:00 AM UTC
  workflow_dispatch: # Allow manual trigger

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: false

permissions:
  contents: read
  issues: write

jobs:
  check-documentation:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Cache npm packages
        uses: actions/cache@v4
        with:
          path: ~/.npm
          key: ${{ runner.os }}-npm-doc-tools
          restore-keys: |
            ${{ runner.os }}-npm-doc-tools-
            ${{ runner.os }}-npm-

      - name: Set up documentation check tools
        run: |
          echo "Setting up environment for documentation checks"
          npm install -g markdownlint-cli markdown-link-check

      - name: Run documentation checks
        id: doc-check
        continue-on-error: true
        run: |
          echo "üìù Starting documentation review..."
          echo ""
          echo "Documentation files in repository:"
          find . -name "*.md" -not -path "./node_modules/*" \
            -not -path "./.git/*" | sort
          echo ""
          echo "Running markdown linting..."
          find . -name "*.md" -not -path "./node_modules/*" \
            -not -path "./.git/*" -exec markdownlint {} + \
            || echo "‚ö†Ô∏è Markdown linting found issues"
          echo ""
          echo "Checking for broken links..."
          find . -name "*.md" -not -path "./node_modules/*" \
            -not -path "./.git/*" -exec markdown-link-check {} \; \
            || echo "‚ö†Ô∏è Found broken links"
          echo ""
          echo "‚úÖ Documentation check complete"

      - name: Create documentation update task for Copilot
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Creating documentation update task..."
          gh issue create \
            --title "üìù Weekly Documentation Review and Update" \
            --body "## ü§ñ Automated Documentation Review

          This is an automated weekly check of the documentation.

          ### Review Checklist

          Please review and update the following documentation files:

          - [ ] **README.md** - Ensure all examples, usage instructions,
            and feature descriptions are current
          - [ ] **.github/CONTRIBUTING.md** - Verify contribution
            guidelines are accurate
          - [ ] **SECURITY.md** - Check security policy is up-to-date
          - [ ] **CODE_OF_CONDUCT.md** - Ensure it's current
          - [ ] Check for broken links and outdated references
          - [ ] Verify code examples are working and up-to-date
          - [ ] Ensure version numbers and badges are current

          ### Copilot Instructions

          @copilot please review all documentation files and suggest
          improvements to ensure they are:
          1. Accurate and up-to-date with the current codebase
          2. Clear and well-structured
          3. Free of broken links or outdated references
          4. Consistent in style and formatting

          Once reviewed, please create a PR with any necessary updates.

          ---

          *This issue was automatically created by the weekly
          documentation check workflow.*
          *Workflow:
          ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}*" \
            --label "documentation,automated,copilot" \
            || echo "Issue creation skipped or failed"
